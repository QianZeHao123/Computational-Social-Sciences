---
title: "Appendix for Computaional Social Science Summative"
author: "Z0195806"
date: "`r Sys.Date()`"
output: 
  pdf_document: 
    latex_engine: xelatex
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Appendix 1 Dataset Pre-processing

**Dataset World Values Survey Wave 7 (2017-2022)**

Link: <https://www.worldvaluessurvey.org/WVSDocumentationWV7.jsp>

**Dataset V-Dem (2022)**

Link: <https://www.v-dem.net/data/dataset-archive/>

It contains data files and original questionnaire.

I download the dataset from this link and put it in "./data" directory.

## 1.1 Read the data from the RData and RDS file

```{r}
current_directory = getwd()
# print(current_directory)
# actual path = current_directory
setwd(current_directory)
# load("./data/WVS_Cross-National_Wave_7_rData_v5_0.rdata")
# WVS.origin = `WVS_Cross-National_Wave_7_v5_0`
# v_dem_2022 = readRDS("./data/2022_CPD_V_Party_R_v2/V-Dem-CPD-Party-V2.rds")
```

# Appendix 2 Read Democracy Dataset Directly

```{r}
dem_data = read.csv("./data/country_level_dem.csv")
```

```{r}
head(dem_data)
```

```{r}
# Using dim() to get both rows and columns
# Prints c(number_of_rows, number_of_columns)
print(dim(dem_data))
```

# Appendix 3 Basic EDA for dem_data

## 3.1 **Summarize the Data**

```{r}
print(summary(dem_data))
```

## 3.2 **Check for Missing Values**

```{r}
# Check if it exists missing value
any_missing_values = any(is.na(dem_data))
# Will print TRUE if there are any NAs, otherwise FALSE
print(any_missing_values)
```

## 3.3 **Bar Plots for Political Satisfaction and** Engagement

```{r message=FALSE, warning=FALSE}
# install.packages("ggplot2")
library(ggplot2)
ggplot(dem_data,
       aes(x = Country, y = Political.satisfaction,
           fill = Country
           )) +
  # Use identity to use the actual values from the data
  geom_bar(stat = "identity", color = "black") +
  labs(title = "Political Satisfaction by Country",
       x = "Country",
       y = "Political Satisfaction") +
  # Rotate x labels for better readability
  theme(axis.text.x = element_text(angle = 90, hjust = 1),
        legend.position = "none")
```

```{r}
ggplot(dem_data,
       aes(x = Country,
           y = Perceived.quality.of.democracy,
           fill = Country
           )) +
  # Use identity to use the actual values from the data
  geom_bar(stat = "identity", color = "black") +
  labs(title = "Political Engagement by Country",
       x = "Country",
       y = "Political Engagement") +
  # Rotate x labels for better readability
  theme(axis.text.x = element_text(angle = 90, hjust = 1),
        legend.position = "none")
```

## 3.4 **Political Satisfaction and** Engagement across Regime

```{r}
ggplot(dem_data, aes(x = Regime, y = Political.satisfaction)) +
  # geom_boxplot(fill = "tomato") +
  geom_boxplot(aes(color = Regime)) +
  labs(title = "Political Satisfaction Across Regimes",
       x = "Regime",
       y = "Political Satisfaction") +
  theme(axis.text.x = element_text(angle = 0, hjust = 1))
```

```{r}
ggplot(dem_data, aes(x = Regime, y = Perceived.quality.of.democracy)) +
  geom_boxplot(aes(color = Regime)) +
  labs(title = "Political Engagement Across Regimes",
       x = "Regime",
       y = "Political Engagement") +
  theme(axis.text.x = element_text(angle = 0, hjust = 1))
```

## 3.5 Relationship between **Political Satisfaction and Social Media Use**

```{r}
ggplot(dem_data, aes(x = Social.media.use, y = Political.satisfaction)) +
  # Color points by Regime to add another layer of information
  geom_point(aes(color = Country)) +
  labs(title = "Social Media Use vs. Political Satisfaction",
       x = "Social Media Use (%)",
       y = "Political Satisfaction") +
  theme(axis.text.x = element_text(angle = 0, hjust = 1),
        legend.position = "none")
```

## 3.6 Correlations between Variables

```{r message=FALSE, warning=FALSE}
# install.packages("dplyr")
library(dplyr)
library(stringr)
dem_data_cor = dem_data %>%
  mutate(Social.media.use = str_remove(Social.media.use, "%") %>% 
           as.numeric() %>% 
           `/`(100))
```

```{r message=FALSE, warning=FALSE}
# install.packages("GGally")
library("GGally")
ggpairs(dem_data_cor[, c("Affective.polarization",
                     "Issue.polarization",
                     "Social.media.use",
                     "Political.participation",
                     "Vote",
                     "Political.satisfaction",
                     "Perceived.quality.of.democracy")]) +
  theme_bw()
```

# Appendix 4 Processing with QCA

```{r}
# install QCA from CRAN
# install.packages("QCA")
```

```{r}
dem_data_new = dem_data %>%
  mutate(Social.media.use = str_remove(Social.media.use, "%") %>% 
           as.numeric() %>% 
           `/`(100),
         Regime = case_when(
           Regime == "Full" ~ 1,
           Regime == "Flawed" ~ 2,
           # Handles any unexpected categories
           TRUE ~ NA_real_
         ))
```

```{r}
# ref: Computational Social Science Week 5: QCA Workshop
library(QCA)
# Crisp set QCA
# Calibration discussion
# -----------------------------------------------------------------
# histogram example
sort(dem_data_new$Affective.polarization)
# -----------------------------------------------------------------
# simplified histogram in QCA
Xplot(
  dem_data_new$Affective.polarization,
  at = seq(from = 0, to = 4, by = 1),
  # breaks, can also use 'pretty' function
  cex = 1.5,
  pch = 15,
  # size and shape of markers
  jitter = TRUE,
  # vertical jitter to avoid overlap
  amount = 0.2
)
# -----------------------------------------------------------------
# default clustering for break point
findTh(
  dem_data_new$Affective.polarization,
  n = 1,
  # number of thresholds, 1 is default but can specify for mvQCA
  hclustm = "complete",
  distm = "manhattan"
)
```
